<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Pro - Ultimate Edition</title>
    <style>
        :root {
            --bg: #060b14;
            --card: #111827;
            --blue-neon: #38bdf8;
            --text: #ffffff;
            --dim: #94a3b8;
            --gold: #fbbf24;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 20px;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        .admin-header {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--card); padding: 15px 25px;
            border-radius: 12px; border: 1px solid #1f2937; margin-bottom: 20px;
        }

        .admin-controls {
            background: #f8fafc; color: #1e293b; padding: 20px;
            border-radius: 16px; margin-bottom: 30px; border: 2px solid var(--blue-neon);
        }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 20px; }
        .card { background: var(--card); border-radius: 15px; padding: 20px; border: 1px solid #1f2937; }
        .card h3 { color: var(--blue-neon); text-align: center; margin-top: 0; border-bottom: 1px solid #1f2937; padding-bottom: 10px; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th { color: var(--dim); font-size: 0.8rem; padding: 8px; }
        td { padding: 10px 5px; text-align: center; border-bottom: 1px solid #1f2937; }

        .input-neon {
            width: 45px; background: var(--blue-neon); border: none;
            color: #000; text-align: center; border-radius: 6px;
            padding: 5px; font-weight: bold; box-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
        }

        /* Ù‚Ù…Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© */
        .match-info-box {
            background: rgba(56, 189, 248, 0.1);
            padding: 12px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px dashed var(--blue-neon);
        }
        .match-info-box h4 { margin: 0 0 10px 0; font-size: 0.9rem; color: var(--gold); text-align: center; }
        
        .info-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.85rem; align-items: center; }
        .info-input { background: #1e293b; color: white; border: 1px solid #334155; border-radius: 4px; padding: 4px; width: 65%; }

        .bracket-container { display: flex; justify-content: space-around; align-items: flex-start; margin-top: 40px; }
        .bracket-col { display: flex; flex-direction: column; justify-content: space-around; gap: 30px; }
        .match-box { background: var(--card); border: 1px solid #374151; width: 220px; border-radius: 10px; overflow: hidden; }
        .team-row { padding: 12px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1f2937; }

        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-start { background: var(--blue-neon); color: #000; }
        .btn-ko { background: var(--gold); color: #000; width: 100%; margin-top: 10px; }
        .hidden { display: none; }
        textarea { width: 100%; height: 70px; border-radius: 8px; border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="admin-header">
        <h1>ğŸ† TOURNAMENT PES 2026</h1>
        <button class="btn" id="adminBtn" style="background: #1e293b; color: white;" onclick="toggleAdmin()">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸ”</button>
    </div>

    <div id="adminPanel" class="admin-controls hidden">
        <div id="setupView">
            <h3>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª (3 ÙØ±Ù‚)</h3>
            <textarea id="teamsInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙØ±Ù‚ (ÙƒÙ„ Ø³Ø·Ø± ÙØ±ÙŠÙ‚)"></textarea>
            <button class="btn btn-start" onclick="initTournament()">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©</button>
        </div>
        <div id="groupActions" class="hidden">
            <button class="btn btn-ko" onclick="startKnockoutPhase()">Ø¨Ø¯Ø¡ Ø§Ù„Ù€ Knockout ğŸ</button>
            <button class="btn" style="background:#ef4444; color:white; margin-top:10px;" onclick="resetAll()">Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
        </div>
    </div>

    <div id="groupView" class="grid"></div>

    <div id="knockoutView" class="hidden">
        <h2 style="text-align: center; color: var(--gold);">ğŸ Ø´Ø¬Ø±Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø¥Ù‚ØµØ§Ø¦ÙŠØ©</h2>
        <div class="bracket-container">
            <div class="bracket-col" id="qf-col"></div>
            <div class="bracket-col" id="sf-col"></div>
            <div class="bracket-col" id="f-col"></div>
        </div>
    </div>
</div>

<script>
    const ADMIN_PASSWORD = "Haytham@2004";
    let store = JSON.parse(localStorage.getItem('tourney_final_v4')) || {
        mode: 'groups',
        groups: [],
        matches: { qf: [], sf: [], f: [] },
        isAdmin: false
    };

    function toggleAdmin() {
        if (!store.isAdmin) {
            let pass = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:");
            if (pass === ADMIN_PASSWORD) {
                store.isAdmin = true;
                document.getElementById('adminBtn').innerText = "Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ğŸ”“";
            } else { alert("Ø®Ø·Ø£!"); return; }
        } else {
            store.isAdmin = false;
            document.getElementById('adminBtn').innerText = "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸ”";
        }
        render();
    }

    function initTournament() {
        const teams = document.getElementById('teamsInput').value.split('\n').filter(t => t.trim());
        if (teams.length < 6) return alert("6 ÙØ±Ù‚ ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰!");
        store.groups = [];
        const shuffled = teams.sort(() => Math.random() - 0.5);
        for (let i = 0; i < shuffled.length; i += 3) {
            store.groups.push({
                name: `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${String.fromCharCode(65 + i/3)}`,
                teams: shuffled.slice(i, i+3).map(n => ({ name: n, w: 0, d: 0, l: 0, pts: 0 })),
                nextMatch: { teams: "ÙØ±ÙŠÙ‚ Ø£ Ø¶Ø¯ ÙØ±ÙŠÙ‚ Ø¨", date: "2024-01-01", time: "00:00" }
            });
        }
        store.mode = 'groups';
        save(); render();
    }

    function updateScore(gIdx, tIdx, field, val) {
        let t = store.groups[gIdx].teams[tIdx];
        t[field] = parseInt(val) || 0;
        t.pts = (t.w * 3) + (t.d * 1);
        store.groups[gIdx].teams.sort((a,b) => b.pts - a.pts);
        save(); render();
    }

    function updateMatchInfo(gIdx, field, val) {
        store.groups[gIdx].nextMatch[field] = val;
        save();
    }

    function startKnockoutPhase() {
        if (!confirm("Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ù‚ØµØ§Ø¦ÙŠØ§ØªØŸ")) return;
        const qualified = [];
        store.groups.forEach(g => { 
            if(g.teams[0]) qualified.push(g.teams[0].name); 
            if(g.teams[1]) qualified.push(g.teams[1].name); 
        });
        store.matches.qf = [];
        for (let i = 0; i < qualified.length; i += 2) {
            if(qualified[i+1]) store.matches.qf.push({ id: i/2, t1: qualified[i], t2: qualified[i+1], s1: 0, s2: 0 });
        }
        store.matches.sf = [{id:0, t1:'??', t2:'??', s1:0, s2:0}, {id:1, t1:'??', t2:'??', s1:0, s2:0}];
        store.matches.f = [{id:0, t1:'??', t2:'??', s1:0, s2:0}];
        store.mode = 'knockout';
        save(); render();
    }

    function updateKM(stage, mIdx, field, val) {
        let m = store.matches[stage][mIdx];
        m[field] = parseInt(val) || 0;
        if (stage === 'qf') {
            let nextIdx = Math.floor(mIdx / 2);
            let teamPos = mIdx % 2 === 0 ? 't1' : 't2';
            if (store.matches.sf[nextIdx]) store.matches.sf[nextIdx][teamPos] = m.s1 > m.s2 ? m.t1 : (m.s2 > m.s1 ? m.t2 : '??');
        } else if (stage === 'sf') {
            let teamPos = mIdx === 0 ? 't1' : 't2';
            store.matches.f[0][teamPos] = m.s1 > m.s2 ? m.t1 : (m.s2 > m.s1 ? m.t2 : '??');
        }
        save(); render();
    }

    function save() { localStorage.setItem('tourney_final_v4', JSON.stringify(store)); }
    function resetAll() { if(confirm("Ø­Ø°ÙØŸ")) { localStorage.clear(); location.reload(); } }

    function render() {
        document.getElementById('adminPanel').classList.toggle('hidden', !store.isAdmin);
        const groupView = document.getElementById('groupView');
        const knockoutView = document.getElementById('knockoutView');

        if (store.mode === 'groups') {
            knockoutView.classList.add('hidden');
            groupView.classList.remove('hidden');
            document.getElementById('groupActions').classList.toggle('hidden', store.groups.length === 0);
            
            groupView.innerHTML = store.groups.map((g, gIdx) => `
                <div class="card">
                    <h3>${g.name}</h3>
                    <table>
                        <tr><th style="text-align:right">Ø§Ù„ÙØ±ÙŠÙ‚</th><th>W</th><th>D</th><th>L</th><th>PTS</th></tr>
                        ${g.teams.map((t, tIdx) => `
                            <tr>
                                <td style="text-align:right"><b>${t.name}</b></td>
                                <td>${store.isAdmin ? `<input type="number" class="input-neon" value="${t.w}" onchange="updateScore(${gIdx},${tIdx},'w',this.value)">` : t.w}</td>
                                <td>${store.isAdmin ? `<input type="number" class="input-neon" value="${t.d}" onchange="updateScore(${gIdx},${tIdx},'d',this.value)">` : t.d}</td>
                                <td>${store.isAdmin ? `<input type="number" class="input-neon" style="background:#ff4444" value="${t.l}" onchange="updateScore(${gIdx},${tIdx},'l',this.value)">` : t.l}</td>
                                <td style="color:var(--blue-neon); font-weight:bold">${t.pts}</td>
                            </tr>
                        `).join('')}
                    </table>

                    <div class="match-info-box">
                        <h4>âš”ï¸ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h4>
                        <div class="info-row">
                            <span>Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©:</span>
                            ${store.isAdmin ? `<input type="text" class="info-input" value="${g.nextMatch.teams}" onchange="updateMatchInfo(${gIdx},'teams',this.value)">` : `<span>${g.nextMatch.teams}</span>`}
                        </div>
                        <div class="info-row">
                            <span>Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                            ${store.isAdmin ? `<input type="date" class="info-input" value="${g.nextMatch.date}" onchange="updateMatchInfo(${gIdx},'date',this.value)">` : `<span>${g.nextMatch.date}</span>`}
                        </div>
                        <div class="info-row">
                            <span>Ø§Ù„ÙˆÙ‚Øª:</span>
                            ${store.isAdmin ? `<input type="time" class="info-input" value="${g.nextMatch.time}" onchange="updateMatchInfo(${gIdx},'time',this.value)">` : `<span>${g.nextMatch.time}</span>`}
                        </div>
                    </div>
                </div>
            `).join('');
        } else {
            groupView.classList.add('hidden');
            knockoutView.classList.remove('hidden');
            const createBox = (m, stage, idx) => `<div class="match-box">
                <div class="team-row"><span>${m.t1}</span>${store.isAdmin ? `<input type="number" class="input-neon" value="${m.s1}" onchange="updateKM('${stage}',${idx},'s1',this.value)">` : `<b>${m.s1}</b>`}</div>
                <div class="team-row"><span>${m.t2}</span>${store.isAdmin ? `<input type="number" class="input-neon" value="${m.s2}" onchange="updateKM('${stage}',${idx},'s2',this.value)">` : `<b>${m.s2}</b>`}</div>
            </div>`;
            document.getElementById('qf-col').innerHTML = `<h4>Ø±Ø¨Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h4>` + store.matches.qf.map((m, i) => createBox(m, 'qf', i)).join('');
            document.getElementById('sf-col').innerHTML = `<h4>Ù†ØµÙ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h4>` + store.matches.sf.map((m, i) => createBox(m, 'sf', i)).join('');
            document.getElementById('f-col').innerHTML = `<h4>Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ğŸ†</h4>` + store.matches.f.map((m, i) => createBox(m, 'f', i)).join('');
        }
    }
    render();
</script>
</body>
</html>